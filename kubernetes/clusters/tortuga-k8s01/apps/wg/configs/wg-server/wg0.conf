[Interface]
Address = {{ .server_tunnel_ip }}/32, {{ .server_tunnel_ip_v6 }}/128
ListenPort = {{ .listen_port }}
PrivateKey = {{ .private_key }}
MTU = 1370
Table = off
# Add link-local address for OSPFv3 (derived from tunnel IPv4: 10.66.0.X -> fe80::X)
PostUp = ip -6 addr add fe80::{{ .server_tunnel_ip | trimPrefix "10.66.0." }}/64 dev %i
PostDown = ip -6 addr del fe80::{{ .server_tunnel_ip | trimPrefix "10.66.0." }}/64 dev %i || true
# Forwarding rules for this interface (cleaned up on interface down)
PostUp = iptables -C FORWARD -i %i -j ACCEPT 2>/dev/null || iptables -A FORWARD -i %i -j ACCEPT
PostUp = iptables -C FORWARD -o %i -j ACCEPT 2>/dev/null || iptables -A FORWARD -o %i -j ACCEPT
PostUp = ip6tables -C FORWARD -i %i -j ACCEPT 2>/dev/null || ip6tables -A FORWARD -i %i -j ACCEPT
PostUp = ip6tables -C FORWARD -o %i -j ACCEPT 2>/dev/null || ip6tables -A FORWARD -o %i -j ACCEPT
PostDown = iptables -D FORWARD -i %i -j ACCEPT 2>/dev/null || true
PostDown = iptables -D FORWARD -o %i -j ACCEPT 2>/dev/null || true
PostDown = ip6tables -D FORWARD -i %i -j ACCEPT 2>/dev/null || true
PostDown = ip6tables -D FORWARD -o %i -j ACCEPT 2>/dev/null || true

[Peer]
# atlantis - routes VPN VLAN traffic through tunnel
PublicKey = {{ .peer_atlantis_pubkey }}
PresharedKey = {{ .peer_atlantis_psk }}
AllowedIPs = {{ .peer_atlantis_allowed_ips }}, 224.0.0.5/32, ff02::5/128, fe80::/10
