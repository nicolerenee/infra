[Interface]
Address = 10.66.0.1/24, fd66::0:1/64
ListenPort = {{ .listen_port }}
PrivateKey = {{ .private_key }}
# Forwarding
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT
PostUp = ip6tables -A FORWARD -i %i -j ACCEPT; ip6tables -A FORWARD -o %i -j ACCEPT
# IPv4 NAT (MASQUERADE for VPN clients)
PostUp = iptables -t nat -A POSTROUTING -s 10.66.0.0/16 -o {{ .wan_interface }} -j MASQUERADE
# IPv6 NAT (MASQUERADE for VPN clients)
PostUp = ip6tables -t nat -A POSTROUTING -s fd66::/64 -o {{ .wan_interface }} -j MASQUERADE
# Port forwarding for qBittorrent (10.66.1.10 / fd66::1:10)
PostUp = iptables -t nat -A PREROUTING -i {{ .wan_interface }} -p tcp --dport 50469 -j DNAT --to-destination 10.66.1.10:50469
PostUp = iptables -t nat -A PREROUTING -i {{ .wan_interface }} -p udp --dport 50469 -j DNAT --to-destination 10.66.1.10:50469
PostUp = ip6tables -t nat -A PREROUTING -i {{ .wan_interface }} -p tcp --dport 50469 -j DNAT --to-destination [fd66::1:10]:50469
PostUp = ip6tables -t nat -A PREROUTING -i {{ .wan_interface }} -p udp --dport 50469 -j DNAT --to-destination [fd66::1:10]:50469
# Cleanup
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT
PostDown = ip6tables -D FORWARD -i %i -j ACCEPT; ip6tables -D FORWARD -o %i -j ACCEPT
PostDown = iptables -t nat -D POSTROUTING -s 10.66.0.0/16 -o {{ .wan_interface }} -j MASQUERADE
PostDown = ip6tables -t nat -D POSTROUTING -s fd66::/64 -o {{ .wan_interface }} -j MASQUERADE
PostDown = iptables -t nat -D PREROUTING -i {{ .wan_interface }} -p tcp --dport 50469 -j DNAT --to-destination 10.66.1.10:50469
PostDown = iptables -t nat -D PREROUTING -i {{ .wan_interface }} -p udp --dport 50469 -j DNAT --to-destination 10.66.1.10:50469
PostDown = ip6tables -t nat -D PREROUTING -i {{ .wan_interface }} -p tcp --dport 50469 -j DNAT --to-destination [fd66::1:10]:50469
PostDown = ip6tables -t nat -D PREROUTING -i {{ .wan_interface }} -p udp --dport 50469 -j DNAT --to-destination [fd66::1:10]:50469

[Peer]
# atlantis - routes VPN VLAN traffic through tunnel
PublicKey = {{ .peer_atlantis_pubkey }}
PresharedKey = {{ .peer_atlantis_psk }}
AllowedIPs = {{ .peer_atlantis_allowed_ips }}
