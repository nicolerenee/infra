[Interface]
Address = 10.66.0.1/24, fd66::0:1/64
ListenPort = 51820
PrivateKey = ${WG_PRIVATE_KEY}
# Forwarding
PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT
PostUp = ip6tables -A FORWARD -i %i -j ACCEPT; ip6tables -A FORWARD -o %i -j ACCEPT
# IPv4 NAT (MASQUERADE for VPN clients)
PostUp = iptables -t nat -A POSTROUTING -s 10.66.0.0/16 -o ${WAN_INTERFACE} -j MASQUERADE
# IPv6 NPTv6 (stateless 1:1 prefix translation)
PostUp = ip6tables -t nat -A POSTROUTING -s fd66::/64 -o ${WAN_INTERFACE} -j NETMAP --to ${PUBLIC_IPV6_PREFIX}
PostUp = ip6tables -t nat -A PREROUTING -d ${PUBLIC_IPV6_PREFIX} -i ${WAN_INTERFACE} -j NETMAP --to fd66::/64
# Port forwarding for qBittorrent (10.66.1.10)
PostUp = iptables -t nat -A PREROUTING -i ${WAN_INTERFACE} -p tcp --dport 50469 -j DNAT --to-destination 10.66.1.10:50469
PostUp = iptables -t nat -A PREROUTING -i ${WAN_INTERFACE} -p udp --dport 50469 -j DNAT --to-destination 10.66.1.10:50469
# Cleanup
PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT
PostDown = ip6tables -D FORWARD -i %i -j ACCEPT; ip6tables -D FORWARD -o %i -j ACCEPT
PostDown = iptables -t nat -D POSTROUTING -s 10.66.0.0/16 -o ${WAN_INTERFACE} -j MASQUERADE
PostDown = ip6tables -t nat -D POSTROUTING -s fd66::/64 -o ${WAN_INTERFACE} -j NETMAP --to ${PUBLIC_IPV6_PREFIX}
PostDown = ip6tables -t nat -D PREROUTING -d ${PUBLIC_IPV6_PREFIX} -i ${WAN_INTERFACE} -j NETMAP --to fd66::/64
PostDown = iptables -t nat -D PREROUTING -i ${WAN_INTERFACE} -p tcp --dport 50469 -j DNAT --to-destination 10.66.1.10:50469
PostDown = iptables -t nat -D PREROUTING -i ${WAN_INTERFACE} -p udp --dport 50469 -j DNAT --to-destination 10.66.1.10:50469

[Peer]
# atlantis - routes VPN VLAN traffic through tunnel
PublicKey = ${WG_PEER_ATLANTIS_PUBKEY}
PresharedKey = ${WG_PEER_ATLANTIS_PSK}
AllowedIPs = 10.66.0.2/32, 10.66.1.0/24, fd66::/64
